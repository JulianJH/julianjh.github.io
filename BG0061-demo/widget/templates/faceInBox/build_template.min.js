var mic,recognition,prompt_timeout,micO_SRC=fileUrl+"/images/mic.gif",micA_SRC=fileUrl+"/images/mic-animate.gif",micS_SRC=fileUrl+"/images/mic-slash.gif",photoFile=styled_path+"/images/face-32x32.png",micWasUsed=!1,chatHistory=[],sceneLoaded=!1,canWrite=!0,responseBot="",humanText="",firstIter=!0,HistoryJson="",message="",responseApi="";"undefined"!=typeof enable_test_images&&enable_test_images&&(photoFile=styled_path+"/images/face-32x32_test.png?"+(new Date).getTime(),fileExists(photoFile).then(function(t){t||(photoFile=styled_path+"/images/face-32x32.png?"+(new Date).getTime())}));var show_on_startup_delay_call,navLg,startedup=!1,enable_prompt_stimuli=!1,matched_url="",snd=new Audio(fileUrl+"/sound/sound_1.mp3"),isWritting='<div class="bot-box"><div class="bot-text typing "> <div class="dot" data-ix="faceload"></div><div class="dot d2" data-ix="faceload-2"></div><div class="dot d3"></div> </div></div>';navLg=navigator.browserLanguage||navigator.language;var effectToggle="fade",unsupportedAvatar=0<window.navigator.userAgent.indexOf("MSIE ")||!!navigator.userAgent.match(/Trident.*rv\:11\./)||-1<navigator.userAgent.toLowerCase().indexOf("firefox");function BuildTemplate(t){showMessageInConsole("BuildTemplate "+templateBG),t=t.replace("[BotID]",botid),$("#BotGenesBot").html(t),$("#BotGenesBot").css("visibility","hidden");t=500;if("undefined"!=typeof delay_build_template&&(t=delay_build_template),setTimeout(function(){isMobile()&&$(window).width()<1e3?($(".BotWrapper").css("width",$(window).width()).css("height",$(window).height()).css("top",0).css("left",0).css("position","fixed"),buildToggle(),"undefined"!=typeof proactivity_mobile_delay&&setTimeout(ShowBot,proactivity_mobile_delay),footerWidth=footerWidthMobile," "==sendBtnMessage?TextInputWidth=footerWidth:(TextInputWidth=.8*footerWidth,TextInputHeight=sendBtnHeight=footerHeight,sendBtnWidth=.2*footerWidth),IterHeight=window.innerHeight-CalculateIterHeightFooter,"undefined"!=typeof HasIconDivHidden&&1==HasIconDivHidden&&1==IconDivOnlyMobile&&setShowHiddenDiv()):("undefined"!=typeof HasIconDivHidden&&1==HasIconDivHidden&&0==IconDivOnlyMobile&&setShowHiddenDiv(),$(".BotWrapper").width(chatWidth).height(chatHeight),isToggle?($(".BotWrapper").css("position","fixed"),buildToggle(),"undefined"!=typeof show_bot_on_startup_delay&&(show_on_startup_delay_call=setTimeout(ToggleBot,show_bot_on_startup_delay))):($(".BotClose").hide(),$(".BotWrapper").show().css("opacity",100)),$(".BotWrapper").css("top",window.innerHeight-initialPosition.bottom).css("left",window.innerWidth-initialPosition.right),$.fn.draggable&&isDraggable?$(".BotWrapper").draggable({handle:".BotHeader",containment:"document"}):$.fn.drags&&isDraggable&&$(".BotWrapper").drags({handle:".BotHeader",containment:"document"}),"undefined"!=typeof has_side_panel&&has_side_panel&&"100"!=xCode&&$.getScript(fileUrl+"/templates/faceInBox/side-panel.js")),$("#BotWrapper").css("border-top-left-radius",BorderRadiusTopLeft).css("border-top-right-radius",BorderRadiusTopRight).css("border-bottom-left-radius",BorderRadiusBottomLeft).css("border-bottom-right-radius",BorderRadiusBottomRight),"undefined"!=typeof turnOffLight&&turnOffLight&&$("<div class='turnOffLight'></div>").insertBefore("body"),$("#botname").append(BotName),""!=company&&$("#company").append(company),""!=live&&$("#live").append(live),createAvatar(),setHeader(),setIterBox(),setFooter(),buildSendBtn(),buildTextInput(),"undefined"!=typeof enable_test_images&&enable_test_images?setTimeout(function(){setColors(),$(".BotChatIconMaterial").addClass("FadeInAndOut")},0):setColors(),setLogo(),setSpeaker(),minimizeButtonChat(),moveIconButtonChat(),setXtoBtnClose(),"undefined"!=typeof tooltipClose&&addTooltipClose(),AutoSpeak&&toogleSpeaker(),(0<window.navigator.userAgent.indexOf("MSIE ")||navigator.userAgent.match(/Trident.*rv\:11\./))&&$(".changingGardient").hasClass("gardient")&&$(".changingGardient").removeClass("gardient").addClass("gard-ie"),"function"==typeof ownFunction&&ownFunction(),$("#BotGenesBot").css("visibility","visible"),"undefined"!=typeof inContainer&&inContainer&&setTimeout(function(){startedup||(wakeUpBot(),startedup=!0)},1e3)},t),"undefined"!=typeof help_messages)for(var e in help_messages)"object"==typeof help_messages[e]?(window.location.origin+window.location.pathname).toLowerCase()!=e.toLowerCase()&&"*"!=e||(help_msg=help_messages[e][0],enable_prompt_stimuli=!0,matched_url=e):(window.location.origin+window.location.pathname).toLowerCase()!=e.toLowerCase()&&"*"!=e||(help_msg=help_messages[e])}function setColors(){$(".BotHeader").css("background-color",headerColor),$(".BotChatIcon").css("background-color",chatIconColor),$("."+typeBotton).css("background-color",MenuButtonColor),$(".BotSendMessage").css("background-color",sendMessageColor),$(".BotChatIcon").hover(function(){$(this).css("background-color",chatIconHoverColor)},function(){$(this).css("background-color",chatIconColor)}),$("."+typeBotton).hover(function(){$(this).css("background-color",MenuButtonHoverColor)},function(){$(this).css("background-color",MenuButtonColor)}),$(".BotSendMessage").hover(function(){$(this).css("background-color",sendMessageHoverColor)},function(){$(this).css("background-color",sendMessageColor)})}function buildTextInput(){TextInputWidth-=sendBtnWidth,$(".BotTextInput").css("width",TextInputWidth+"px").css("float",TextInputFloat).css("height",TextInputHeight).css("color",TextInputColor).css("border",TextInputBorder).css("padding-left",TextInputPaddLeft).css("padding-right",TextInputPaddRight).css("padding-top",TextInputPaddTop).css("padding-bottom",TextInputPaddBottom).css("font-family",chatFontFamily),footerShadow?$(".BotFooter").css("box-shadow","0px 0 4px #ABABAB"):footerBorder&&($(".BotFooter").css("border",void 0),footerBorderWidth,footerBorderColor),$(".BotTextInput").focus(function(){$("#BotContent").stop(!0,!0).animate({scrollTop:$("#BotContent").prop("scrollHeight")},500)}),attachImputEventhandler()}function setLogo(){var e;hasLogo&&(e=styled_path+"/images/logo.png","undefined"!=typeof enable_test_images&&enable_test_images?(e=styled_path+"/images/logo_test.png?"+(new Date).getTime(),fileExists(e).then(function(t){t||(e=styled_path+"/images/logo.png?"+(new Date).getTime()),$(".BotLogo").append("<img src='"+e+"' alt='' >"),$(".BotLogo img").css("height",LogoMaxHeight)})):($(".BotLogo").append("<img src='"+e+"' alt='' >"),$(".BotLogo img").css("height",LogoMaxHeight)),$(".BotLogo").css("float",LogoFloat),$(".BotLogo").css("padding",LogoPadding),$(".BotLogo").show())}function buildToggle(){var e,o,a,t;e=hasTextChatIcon?'<div class="textChatIcon">'+textChatIcon+"</div>":"","undefined"!=typeof enable_test_images&&enable_test_images?"undefined"!=typeof hasImageIconToggle&&hasImageIconToggle?(a='<img class="facePrompt" src="'+(o=styled_path+"/images/facePrompt_test.png?"+(new Date).getTime())+'">',fileExists(o).then(function(t){t||(o=styled_path+"/images/facePrompt.png?"+(new Date).getTime(),a='<img class="facePrompt" src="'+o+'">');t='<div id="btnToggle"><div class="BotChatIconMaterial faa-parent animated-hover faa-slow" onclick="ToggleBot();">'+e+'<span id="iconChat">'+a+" "+toggleBotton+"</span></div></div>";("undefined"!=typeof inContainer&&inContainer?$("#BotGenesBot"):$("body")).append(t)})):(a='<i class="fa '+toggleIcon+'" aria-hidden="true"></i>',t='<div id="btnToggle"><div class="BotChatIconMaterial faa-parent animated-hover faa-slow" onclick="ToggleBot();">'+e+'<span id="iconChat">'+a+" "+toggleBotton+"</span></div></div>",("undefined"!=typeof inContainer&&inContainer?$("#BotGenesBot"):$("body")).append(t)):(a="undefined"!=typeof hasImageIconToggle&&hasImageIconToggle?'<img class="facePrompt" src="'+(o=styled_path+"/images/facePrompt.png")+'">':'<i class="fa '+toggleIcon+'" aria-hidden="true"></i>',t='<div id="btnToggle"><div class="BotChatIconMaterial faa-parent animated-hover faa-slow" onclick="ToggleBot();">'+e+'<span id="iconChat">'+a+" "+toggleBotton+"</span></div></div>",("undefined"!=typeof inContainer&&inContainer?$("#BotGenesBot"):$("body")).append(t)),$(".BotClose").show(),"undefined"!=typeof noAnimation&&noAnimation?$(".BotChatIconMaterial").removeClass("FadeInAndOut"):$(".BotChatIconMaterial").addClass("FadeInAndOut")}function setFooter(){var t;$(".BotFooter").width(footerWidth).height(footerHeight),footerMessageUsage&&($(".BotFooter").append('<p class="bg-p" id="footerMessage"></p>'),$("#footerMessage").css("margin-top","5px").css("font-style","italic").css("fontSize",footerMessageSize).hide().append(BotName+" "+footerMessage)),"undefined"!=typeof copyrightOutFooter&&copyrightOutFooter&&(t=$("#copyrigth").html(),$("#copyrigth").remove(),$("<p class='bg-p' id='copyrigth' style='font-size: 10px;position: absolute;'>"+t+"</p>").insertAfter("#BotFooter")),"BotGenes"==byWho&&($("#byWho").empty().css("color","#afadad").append("Brain by BotGenes<sup>&#174;</sup>").attr("href","http://botgenes.com"),$("#copyrigth").css("color","#afadad"),isMobile()&&(showMessageInConsole("BG: by BotGenes has no hyperlink in mobile"),$("#byWho").removeAttr("href")))}function setIterBox(){$(".BotContent").height(IterHeight),"none"!=hasAvatar&&"name"!=hasAvatar&&(botContentWidth=chatWidth-1.6*avatarWidth)}function createAvatar(){switch("none"!=hasAvatar&&"name"!=hasAvatar&&($(".BotContent").css("float",chatFloat),$(".TextContent").hide(),$(".BotBody").hide(),$("#BotAvatar").css("float",avatarFloat)),$(".BotBody").css("background-color",BotBodyColor),$(".BotBody").css("border-bottom-right-radius",BotBodyRadiusBottomRight),$(".BotBody").css("border-bottom-left-radius",BotBodyRadiusBottomLeft),hasAvatar){case"head":unsupportedAvatar?(hasSpeaker=!1,setSpeaker(),createPhotoAvatar(),$("#BotAvatar").addClass("unsupportedAvatar")):(showMessageInConsole("hasAvatar / Head / else"),setSpeaker(),createHeadAvatar());break;case"body":unsupportedAvatar?(hasSpeaker=!1,setSpeaker(),createPhotoAvatar(),$("#BotAvatar").addClass("unsupportedAvatar")):isMobile()?(hasSpeaker=!1,setSpeaker(),$(".TextContent").show(),$(".BotBody").show()):createBodyAvatar();break;case"photo":createPhotoAvatar();break;case"none":$(".TextContent").hide();break;case"name":$(".TextContent").show()}}function setXtoBtnClose(){"undefined"!=typeof noIconBtnClose&&noIconBtnClose&&$(".BotClose").html("<span class='closeLetterX'>X</span>")}function addTooltipClose(){"undefined"!=typeof tooltipClose&&($(".BotClose").addClass("tooltip-toggle"),$(".BotClose").attr("data-tooltip",tooltipClose)),"undefined"!=typeof tooltipDraggable&&($(".BotDraggableIcon").addClass("tooltip-toggle"),$(".BotDraggableIcon").attr("data-tooltip",tooltipDraggable))}function minimizeButtonChat(){"undefined"!=typeof hasMinimizeIcon&&(hasMinimizeIcon&&("name"==hasAvatar||"undefined"!=typeof use_svg_icons&&use_svg_icons)?($(".BotClose").before("<div class='BotCloseChat BotMenuButton primaryButton' onclick='restartChat();'><img src='"+styled_path+"/images/close_button.svg' style='height: 1.5em;width: 1.5em;'></div>"),$(".BotClose").html("<img src='"+styled_path+"/images/collapse.svg' style='height: 1.5em;width: 1.5em;'>")):hasMinimizeIcon&&"name"!=hasAvatar&&($(".BotClose").before("<div class='BotCloseChat BotMenuButton primaryButton' onclick='restartChat();'><i class='fa fa-times-circle'></i></div>"),$(".BotClose").html("<i class='fa fa-minus-circle'></i>")))}function moveIconButtonChat(){"undefined"!=typeof hasMoveIcon&&hasMoveIcon&&$(".BotMenuButton").last().after("<div class='BotDraggableIcon BotMenuButton'><i class='fa fa-arrows'></i></div>")}function restartChat(){ToggleBot(),startedup=!1,setTimeout(function(){$(".BotContent").empty(),bgStorage("remove","chatHistory"+botid),bgStorage("remove","bgtoken"+botid),bgStorage("clear","chatHistory"+botid),user=null,response_shown=!(firstIter=!0)},500)}function setHeader(){$(".BotHeader").css("display",hasHeader),$(".BotHeader").height(headerHeight),has_subheader&&("name"==hasAvatar?$(".SubHeader").height(headerHeight):$(".SubHeader").height(avatarWidth+20)),$("#title").append(headerTitle)}function loadHistory(t){for(((new Date).getTime()-Date.parse(t[t.length-1].datetime))/1e3/60>sessionTime&&GetBotResponse("CONNECT IDENTITY "+navigator.userLanguage+" BG "+navigator.systemLanguage+" BG "+navLg+" ip "+ipAddress),i=0;i<t.length;i++){var e=t[i];""!=e.question&&$("#BotContent").append("<div class='user-box'><div class='user-text'>"+e.question+"</div></div>"),responseBot=purge(e.response),"BG0058"==botid&&(responseBot.text=responseBot.text.replace(/(<img(?!.*?\bclass\s*=\s*(?:"|')\s*survey-emoji\s*(?:"|')).*?>)/g,"<br><br>$1<br><br>")),showMessageInConsole("responseBot.text "+responseBot.text),""==responseBot.text&&0<responseBot.buttons.length?$("#BotContent").append("<div class='bot-box'>"+createButton(responseBot.buttons)+"</div>"):""!=responseBot.text&&0<responseBot.buttons.length?$("#BotContent").append("<div class='bot-box'><div class='bot-text'>"+responseBot.text+"</div>"+createButton(responseBot.buttons)+"</div>"):""!=responseBot.text&&createMultipleBubbles(responseBot.text),0!=responseBot.ads.length&&renderAds(responseBot.ads)}$(".bot-text").css("background",botBoxTextBackground),$(".bot-text").css("box-shadow",botBoxShadow),"BG0058"==botid&&($(".bot-text:has('img:not(.survey-emoji)')").css("background","transparent"),$(".bot-text:has('img:not(.survey-emoji)')").css("box-shadow","")),"none"!=botBoxBackground?$(".bot-box").css("background",botBoxBackground):$(".bot-box").css("background-image",'url("'+photoFile+'")'),"undefined"!=typeof colorLink?($(".bot-box a").css("color",colorLink),$(".bot-box .helpme").css("color",colorLink)):($(".bot-box a").css("color",MenuButtonColor),$(".bot-box .helpme").css("color",MenuButtonColor)),$(".user-text").css("background",userbubles),$(".user-text").css("color",userbublesColor),$(".user-text").css("box-shadow",userBoxShadow),$('img[data-bg-zoomable="true"]').off("click",fullscreenHandler).click(fullscreenHandler)}function fullscreenHandler(){this.requestFullscreen()}function setSpeakRecognition(){var t;1==hasMic&&($("Body").prepend('<script class="bg-script" src="'+fileUrl+'/libraries/SR.js"><\/script>'),t=$("#BotTextInput").width()-lefMicPosition,setTimeout(function(){$("#mic").css("bottom",0).css("left",t)},500))}function showQuestion(t){$("#BotContent").append("<div class='user-box'><div class='user-text'>"+t+"</div></div>"),$("#BotContent").stop(!0,!0).animate({scrollTop:$("#BotContent").prop("scrollHeight")},500),$("#BotContent").append(isWritting),$(".user-text").css("background",userbubles),$(".user-text").css("color",userbublesColor),response_show=!1}function showResponse(){if(!response_shown&&""!=responseApi){response_shown=!0,showMessageInConsole("ShowResponse"),$(".typing").remove(),"BG0058"==botid&&(responseBot.text=responseBot.text.replace(/(<img(?!.*?\bclass\s*=\s*(?:"|')\s*survey-emoji\s*(?:"|')).*?>)/g,"<br><br>$1<br><br>")),"undefined"!=typeof divide_lists_in_bubble&&divide_lists_in_bubble&&(responseBot.text=responseBot.text.replace(/(<[ou]l[^>]*>)/g,"<br><br>$1"),responseBot.text=responseBot.text.replace(/(<\/[ou]l>)/g,"$1<br><br>")),""==responseBot.text&&0!=responseBot.buttons.length?$("#BotContent").append("<div class='bot-box'>"+createButton(responseBot.buttons)+"</div>"):responseBot.hasOwnProperty("buttons")&&0!=responseBot.buttons.length&&""!=responseBot.text?$("#BotContent").append("<div class='bot-box'><div class='bot-text'>"+responseBot.text+"</div>"+createButton(responseBot.buttons)+"</div>"):""!=responseBot.text&&createMultipleBubbles(responseBot.text);try{snd.play()}catch(t){showMessageInConsole("BG Error on play: "+t)}$("#BotContent").stop(!0,!0).animate({scrollTop:$("#BotContent").prop("scrollHeight")},500),$("#footerMessage").hide(),$(".bot-text").css("background",botBoxTextBackground),$(".bot-text").css("box-shadow",botBoxShadow),"BG0058"==botid&&($(".bot-text:has('img:not(.survey-emoji)')").css("background","transparent"),$(".bot-text:has('img:not(.survey-emoji)')").css("box-shadow","")),"none"!=botBoxBackground?$(".bot-box").css("background",botBoxBackground):$(".bot-box").css("background-image",'url("'+photoFile+'")'),"undefined"!=typeof colorLink?($(".bot-box a").css("color",colorLink),$(".bot-box .helpme").css("color",colorLink)):($(".bot-box a").css("color",MenuButtonColor),$(".bot-box .helpme").css("color",MenuButtonColor)),micWasUsed&&ASR(),inputTextDisabled(!1),$("#BotTextInput").bg_focus(),saveHistory(),responseApi="","function"==typeof postResponse&&postResponse(responseBot.text),$('img[data-bg-zoomable="true"]').off("click",fullscreenHandler).click(fullscreenHandler)}}function checkResponseBotTextBreaks(t){var e=[],o=[];for(t=t.replace(/<br[^>]*>/g,"<br>"),regex1=new RegExp(/<br><br>/g);m=regex1.exec(t);)e.push(m.index);for(var a=0;a<e.length+1;a++)o[a]=0==a?t.substring(0,e[a]):t.substring(e[a-1]+8,e[a]);return o}function createMultipleBubbles(t){for(var e=checkResponseBotTextBreaks(t),o=0;o<e.length;o++)""!=e[o]&&(o==e.length-1?$("#BotContent").append("<div class='bot-box'><div class='bot-text'>"+e[o]+"</div></div>"):$("#BotContent").append("<div class='bot-box'><div class='bot-text bot-middle-text'>"+e[o]+"</div></div>"))}function createButton(t){switch(t.length){case 1:divButton=void 0===t[0].onclick?'<a href="'+t[0].url+'" class="bot-button"><p class="bg-p">'+t[0].title+"</p></a>":'<a onclick="'+t[0].onclick+'" class="bot-button"><p class="bg-p">'+t[0].title+"</p></a>";break;case 2:divButton=void 0===t[0].onclick?'<a onclick="#" href="'+t[0].url+'" class="bot-button top"><p class="bg-p">'+t[0].title+'</p></a><a href="'+t[1].url+'" class="bot-button bottom"><p class="bg-p">'+t[1].title+"</p></a>":'<a onclick="'+t[0].onclick+'"  class="bot-button top"><p class="bg-p">'+t[0].title+'</p></a><a  onclick="'+t[1].onclick+'" class="bot-button bottom"><p class="bg-p">'+t[1].title+"</p></a>";break;default:if(void 0===t[0].onclick){for(divButton='<a onclick="#" href="'+t[0].url+'" class="bot-button top"><p class="bg-p">'+t[0].title+"</p></a>",i=1;i<t.length-1;i++)divButton+='<a onclick="#" href='+t[i].url+'" class="bot-button mid"><p class="bg-p">'+t[i].title+"</p></a>";divbutton+='<a onclick="#" href="'+t[t.length-1].url+'" class="bot-button bottom"><p class="bg-p">'+t[t.length-1].title+"</p></a>"}else{for(divButton='<a onclick="'+t[0].onclick+'" class="bot-button top"><p class="bg-p">'+t[0].title+"</p></a>",i=1;i<t.length-1;i++)divButton+='<a onclick="'+t[i].onclick+'" class="bot-button mid"><p class="bg-p">'+t[i].title+"</p></a>";divbutton+='<a onclick="'+t[t.onclick-1].url+'" class="bot-button bottom"><p class="bg-p">'+t[t.length-1].title+"</p></a>"}}return divButton}function haveThisButton(t){var e,o=0;if(t.length>buttonsConvert.length)return!1;for(var a=0;a<t.length;a++){e=t[a];for(var n=0;n<buttonsConvert.length;n++)void 0!==buttonsConvert[e]&&o++}return t.length==o}function renderAds(t){$("#BotContent").append(isWritting),adsShow=void 0===t.html?'<a href="'+t.target+'"> <div class="bot-box"><img class="bot-image" src="'+t.file+'"></div></a>':t.html,$(".typing").remove(),$("#BotContent").append(adsShow),inputTextDisabled(!1),$("#BotTextInput").bg_focus()}function createPhotoAvatar(){var e,o;showMessageInConsole("BG: deploying photo avatar"),showMessageInConsole("BG: deploying avatar"),"photo"!=hasAvatar?(avatar_div_object=document.createElement("div"),avatar_div_object.id="image_div",e=document.createElement("IMG"),"undefined"!=typeof enable_test_images&&enable_test_images?(e.src=styled_path+"/images/"+botid+"_test.png?"+(new Date).getTime(),fileExists(e.src).then(function(t){t||(e.src=styled_path+"/images/"+botid+".png?"+(new Date).getTime()),avatar_div_object.appendChild(e),"body"==hasAvatar?($("#BotAvatar").remove(),$("<div id='BotAvatar'></div>").insertBefore(".BotHeader"),$("#BotAvatar").css("bottom","0px")):"head"==hasAvatar&&($("#BotAvatar").remove(),$(".BotHeader").prepend("<div id='BotAvatar'></div>"),e.style.height=LogoMaxHeight),document.getElementById("BotAvatar").appendChild(avatar_div_object)})):(e.src=styled_path+"/images/"+botid+".png",avatar_div_object.appendChild(e),"body"==hasAvatar?($("#BotAvatar").remove(),$("<div id='BotAvatar'></div>").insertBefore(".BotHeader"),$("#BotAvatar").css("bottom","0px")):"head"==hasAvatar&&($("#BotAvatar").remove(),$(".BotHeader").prepend("<div id='BotAvatar'></div>"),e.style.height=LogoMaxHeight),document.getElementById("BotAvatar").appendChild(avatar_div_object)),has_subheader&&$(".TextContent").show()):(o=document.createElement("IMG"),"undefined"==typeof photo_avatar_image&&(photo_avatar_image="avatar.png"),"undefined"!=typeof enable_test_images&&enable_test_images?(o.src=styled_path+"/images/avatar_test.png?"+(new Date).getTime(),fileExists(o.src).then(function(t){t||(o.src=styled_path+"/images/avatar.png?"+(new Date).getTime()),o.width=avatarWidth,$(".SubHeader").css("min-height",minHeightSubHeader),has_subheader&&($("#BotAvatar").html(o),$(".TextContent").show())})):(o.src=styled_path+"/images/avatar.png?"+(new Date).getTime(),o.width=avatarWidth,$(".SubHeader").css("min-height",minHeightSubHeader),has_subheader&&($("#BotAvatar").html(o),$(".TextContent").show()))),$(".BotBody").show()}function createBodyAvatar(){var t=document.createElement("div");t.id="avatar_div",$("#BotAvatar").remove(),$("<div id='BotAvatar'></div>").insertBefore(".BotHeader"),document.getElementById("BotAvatar").appendChild(t);var e=document.write;document.write=function(){document.getElementById("avatar_div").innerHTML=[].concat.apply([],arguments).join("")};var o=document.createElement("script");o.setAttribute("type","text/javascript"),o.className="bg-script",msEmbed_params="object"!=typeof avatarID&&"undefined"!=typeof avatarID?"'"+botid+"','"+botid+"','"+cdn_base_url+"/"+botid+"/avatar"+avatarID.toLocaleLowerCase()+"',"+avatarOrginalSize:"'"+botid+"','"+botid+"','"+cdn_base_url+"/"+botid+"-"+bg_style+"/avatar',"+avatarOrginalSize,o.innerHTML="msEmbed("+msEmbed_params+");",t.appendChild(o),document.write=e}function createHeadAvatar(){showMessageInConsole("BG: deploying head avatar");var t=document.createElement("div");t.id="avatar_div",$("#BotAvatar").remove(),$(".BotHeader").prepend("<div id='BotAvatar'></div>"),document.getElementById("BotAvatar").appendChild(t);var e=document.write;document.write=function(){document.getElementById("avatar_div").innerHTML=[].concat.apply([],arguments).join("")};var o=avatarChangeTimeOfDay();avatarUrl=cdn_styled_path+"/avatar"+o,msEmbed_params="'"+botid+"','"+botid+"','"+avatarUrl+"',"+avatarWidth+","+avatarHeight;o=document.createElement("script");o.setAttribute("type","text/javascript"),o.className="bg-script",o.text="msEmbed("+msEmbed_params+");",t.appendChild(o),document.getElementById("BotAvatar").appendChild(t),document.write=e,$("#avatar_div").css("float","left"),document.write=e,$(".SubHeader").css("min-height",minHeightSubHeader)}function changeWidth(){var t;sceneLoaded?($("#"+botid).width(avatarWidth),$("#"+botid+"Char1Canvas").width(avatarWidth),t=$("#"+botid+"Char1Canvas").height(),$("#"+botid+"Char1Div").width(avatarWidth).height(t),$("#"+botid).width(avatarWidth).height(t),has_subheader&&$(".SubHeader").height(t+10)):setTimeout(changeWidth,50)}function onSceneLoaded(t){showMessageInConsole("BG: sceneLoaded"),sceneLoaded=!0,$(".BotBody").show(),has_subheader&&$(".TextContent").show()}function customizeToogleSpeaker(){speaker_off_icon="undefined"==typeof speaker_off_icon?'<i class="fa fa-volume-off" aria-hidden="true"></i>':speaker_off_icon,speaker_on_icon="undefined"==typeof speaker_on_icon?'<i class="fa fa-volume-up" aria-hidden="true"></i>':speaker_on_icon,canSpeak?($(".BotSound").empty().css("background-color",SpeakColor).html(speaker_off_icon).hover(function(){$(this).css("background-color",SpeakHoverColor)},function(){$(this).css("background-color",SpeakColor)}),canSpeak=!1):(canSpeak=!0,$(".BotSound").empty().css("background-color",SpeakHoverColor).html(speaker_on_icon).hover(function(){$(this).css("background-color",SpeakColor)},function(){$(this).css("background-color",SpeakHoverColor)}))}function ToggleBot(){clearTimeout(show_on_startup_delay_call),startedup||(wakeUpBot(),startedup=!0),isMobile()&&$(".BotChatIconMaterial").fadeToggle("fast"),"undefined"!=typeof noAnimation&&noAnimation?$(".BotWrapper").toggle(function(){$("#BotContent").stop(!0,!0).animate({scrollTop:$("#BotContent").prop("scrollHeight")},1e3)}):$(".BotWrapper").toggle(effectToggle,{},750,function(){$("#BotContent").stop(!0,!0).animate({scrollTop:$("#BotContent").prop("scrollHeight")},1e3)}),$("#btnToggle").is(":visible")?($("#btnToggle").hide("slow"),"undefined"!=typeof turnOffLight&&turnOffLight&&($(".turnOffLight").animate({opacity:.6},1e3),$(".turnOffLight").css("display","block"))):($("#btnToggle").show("slow"),"undefined"!=typeof turnOffLight&&turnOffLight&&$(".turnOffLight").animate({opacity:0},{duration:1e3,complete:function(){$(".turnOffLight").css("display","none")}})),"undefined"!=typeof isHumanChat&&isHumanChat&&(isHumanChat=!1,load_bot_config()),"function"==typeof customFunctions&&customFunctions()}function ShowBot(){startedup||(wakeUpBot(),startedup=!0),"undefined"!=typeof noAnimation&&noAnimation?$(".BotWrapper").show():$(".BotWrapper").show(effectToggle,{},750),chat_is_open=!0,hide_prompt_help(),$(".BotChatIconMaterial").removeClass("FadeInAndOut"),setTimeout(function(){$("#BotContent").stop(!0,!0).animate({scrollTop:$("#BotContent").prop("scrollHeight")},1e3)},1e3),isMobile()&&$(".BotChatIconMaterial").fadeOut("fast")}function avatarChangeTimeOfDay(){if("undefined"==typeof startNigthTime||"undefined"==typeof finishNigthTime)return"";var t=(new Date).getHours();return t<startNigthTime&&t>finishNigthTime?"/A":"/B"}function charactersCount(t){t=t.length;$("#quantity").empty().append(t)}function add_btn_toggle(){try{$("#btnToggle").append('<div class="bg_prompt"></div>'),$(".bg_prompt").click(function(){enable_prompt_stimuli&&(messageTimeout=startedup?1e3:2e3,setTimeout(function(){helpMe(help_messages[matched_url][1])},messageTimeout)),ToggleBot()}),document.getElementsByClassName("BotChatIconMaterial")[0].addEventListener("click",ShowBot),"undefined"==typeof initial_promt_delay&&("undefined"!=typeof prompt_cycle_mobile&&isMobile()&&(prompt_cycle=prompt_cycle_mobile),initial_promt_delay=prompt_cycle),hide_prompt_help(initial_promt_delay)}catch(t){showMessageInConsole("Error at btnToggle: "+t),setTimeout(add_btn_toggle,1e3)}}function hide_prompt_help(t){null==t&&("undefined"!=typeof prompt_cycle_mobile&&isMobile()&&(prompt_cycle=prompt_cycle_mobile),t=prompt_cycle);var e=$(".bg_prompt")[0];e.classList.remove("show_prompt"),e.classList.add("bg_prompt"),isHidden=!isHidden,e.style.visibility="hidden",(!isMobile()&&("undefined"!=typeof has_prompt_desktop&&has_prompt_desktop||"undefined"==typeof has_prompt_desktop)||isMobile()&&("undefined"!=typeof has_prompt_mobile&&has_prompt_mobile||"undefined"==typeof has_prompt_mobile))&&(prompt_timeout=setTimeout(function(){show_prompt_help()},t))}function show_prompt_help(){var t;chat_is_open||((t=$(".bg_prompt")[0]).classList.add("show_prompt"),t.style.visibility="visible",t.style.backgroundColor=chatIconColor,t.innerHTML=help_msg,isHidden=!isHidden,"undefined"!=typeof prompt_duration_mobile&&isMobile()&&(prompt_duration=prompt_duration_mobile),prompt_timeout=setTimeout(function(){hide_prompt_help()},prompt_duration))}$(function(){$("body").append('<div id="BotGenesBot"></div>'),$("head").append('<script type="text/javascript" class="bg-script" src="'+base_url+'/libraries/9a0517c172.js"><\/script>'),$.get(fileUrl+"/templates/"+templateBG+"/uiTemplate.html",function(t){BuildTemplate(t)})}),"boolean"==typeof animate_button&&animate_button&&setTimeout(add_btn_toggle,3e3),document.addEventListener("DOMContentLoaded",function(t){document.querySelectorAll("img").forEach(function(t){t.onerror=function(){this.style.display="none"}})});var lastWindowWidth=$(window).width(),lastWindowHeight=$(window).height();function setShowHiddenDiv(){var t="<div class='closeButton BotMenuButton' id='toggleDivHidden'>"+content_icon+"</div>";"down"==whereIconDiv?($(t).insertBefore("#BotTextInput"),$("#toggleDivHidden").css("float",floatIconDiv),$("#BotTextInput").css("width",bgTxtInputMobileAux)):$(t).appendTo(".BotHeader");t="<div class='div_aux_style' id='div_aux_show'></div>";"down"==whereShowDivAux?($(t).insertAfter(".BotFooter"),$("#div_aux_show").css("position","relative").css("top","-"+heightShowDivAux),isMobile()&&window.innerWidth<720&&$("#div_aux_show").css("width",lastWindowWidth)):($(t).insertAfter(".BotHeader"),$("#div_aux_show").css("position","absolute").css("top",positionTopDivAux),isMobile()&&window.innerWidth<720&&$("#div_aux_show").css("top",positionTopDivAuxMobile).css("width",lastWindowWidth)),$("#div_aux_show").css("height",heightShowDivAux).css("width",widthShowDivAux),isMobile()&&window.innerWidth<720&&$("#div_aux_show").css("width","95%").css("height",heightShowDivAuxMobile),isMobile()&&window.innerWidth>window.innerHeight&&(820<window.innerWidth||$("#div_aux_show").css("top",headerHeight+5).css("width","97%").css("height",window.innerHeight-100)),$.getScript(fileUrl+"/templates/faceInBox/div-aux.js",function(){showMessageInConsole("BG: Div Auxiliar done!")}),$.fn.draggable&&isDraggableAux?$(".div_aux_style").draggable({handle:".div-aux-header"}):$.fn.drags&&isDraggableAux&&$(".div_aux_style").drags({handle:".div-aux-header"}),$("#toggleDivHidden").click(function(){$("#div_aux_show")[methodEffectAux](speedEffectAux)})}$(window).resize(function(){var t,e;isMobile()&&(t=$(window).width(),e=$(window).height(),$("#BotContent").css("height",e-CalculateIterHeightFooter),lastWindowWidth=t,lastWindowHeight=e)});